<!-- =============================================================================
     TEMPLATE: LISTA DE TAREAS
     =============================================================================
     Esta página muestra todas las tareas guardadas en las cookies del navegador
     
     CONCEPTOS CLAVE:
     - extends: Hereda la estructura del template layout.html
     - block: Define el contenido específico de esta página
     - if/else: Estructuras condicionales de Jinja2
     - for: Bucle para iterar sobre una lista
     - variable: Muestra el valor de una variable
     - tarea.id: Variable especial que contiene el índice del bucle (empieza en 0)
     ============================================================================= -->
<!-- Heredamos la estructura del template layout.html -->
{% extends "layout.html" %}
<!-- Definimos el título de esta página -->
{% block title %}Tareas{% endblock %}
<!-- Definimos el contenido específico de esta página -->
{% block content %}
<section class="container mt-4" id="tareas">
  <header>
    <h1>Tareas</h1>
    <!-- Título de la página -->
    <p>Estas son las tareas que tienes que hacer:</p>
    <!-- Descripción -->
  </header>
  <!-- Botón para crear nueva tarea -->
  <!-- class="btn btn-primary" = Estilo de botón azul de Bootstrap -->
  <!-- mb-3 = Margen inferior (margin-bottom) -->
  <!-- title="..." = Texto que aparece al pasar el mouse sobre el botón -->
  <a href="/crear" class="btn btn-primary mb-3" title="Crear Nueva Tarea">
    <i class="bi bi-plus-lg me-1"></i>
    Nueva Tarea
  </a>
  <!-- CONDICIONAL: Verificamos si hay tareas para mostrar -->
  {% if tareas %}
  <!-- Si hay tareas, las mostramos en una lista -->
  <!-- list-group = Clase de Bootstrap para crear listas estilizadas -->
  <div class="list-group">
    <!-- BUCLE: Iteramos sobre cada tarea en la lista -->
    {% for tarea in tareas %}
    <!-- list-group-item = Cada elemento de la lista -->
    <!-- d-flex justify-content-between = Flexbox para alinear elementos -->
    <!-- align-items-center = Centra verticalmente los elementos -->
    {% set is_done = tarea.estado == 'completada' %}
    <div class="list-group-item d-flex justify-content-between align-items-center {{ 'list-group-item-success' if is_done else 'list-group-item-warning' }}">
      <!-- Mostramos el nombre de la tarea -->
      <a href="/tarea/{{ tarea.id }}" class="text-decoration-none">
        <span class="fw-semibold">{{ tarea.nombre }}</span>
      </a>
      <!-- Grupo de botones para cada tarea -->
      <!-- btn-group = Agrupa botones horizontalmente -->
      <!-- role="group" = Accesibilidad para lectores de pantalla -->
      <div class="btn-group" role="group">
        <!-- Botón Ver detalle -->
        <!-- Botón Editar -->
        <!-- btn-sm = Botón pequeño -->
        <!-- btn-outline-primary = Botón con borde azul -->
        <!-- {{ tarea.id }} = Índice de la tarea actual -->
        <a href="/editar/{{ tarea.id }}" class="btn btn-sm btn-outline-primary">
          <i class="bi bi-pencil-square me-1"></i>
          Editar
        </a>
        <!-- Botón Eliminar -->
        <!-- btn-outline-danger = Botón con borde rojo -->
        <!-- onclick="..." = JavaScript que pide confirmación antes de eliminar -->
        <a href="/eliminar/{{ tarea.id }}" class="btn btn-sm btn-outline-danger delete-tarea" data-id="{{ tarea.id }}">
          <i class="bi bi-trash me-1"></i>
          Eliminar
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <!-- Si no hay tareas, mostramos un mensaje -->
  <!-- alert alert-warning = Alerta amarilla de Bootstrap -->
  <div class="alert alert-warning">
    No hay tareas pendientes. ¡Agrega una nueva tarea!
  </div>
  {% endif %}
</section>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.delete-tarea').forEach((link) => {
      link.addEventListener('click', async (ev) => {
        ev.preventDefault();
        const id = link.getAttribute('data-id');
        const ok = window.confirm('¿Estás seguro de que quieres eliminar esta tarea?');
        if (!ok) return;
        try {
          await apiFetch(`/api/tarea/${id}`, { method: 'DELETE' });
          window.location.href = '/';
        } catch (err) {
          showFlash(err.message || 'No se pudo eliminar la tarea', 'danger');
        }
      });
    });
  });
</script>
{% endblock %}